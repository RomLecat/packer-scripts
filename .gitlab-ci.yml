stages:
  - preparation
  - build

upload_ks:
  image:
    name: amazon/aws-cli
    entrypoint: [""]
  stage: preparation
  script:
    - aws --endpoint https://s3.lecat.pro s3 cp ./kickstart s3://tmp/kickstart --acl public-read --recursive

check_conf:
  image:
    name: hashicorp/packer:light
    entrypoint: [""]
  stage: preparation
  script:
    - packer validate vcenter-centos7.json
    - packer validate vcenter-centos8.json
    - packer validate vcenter-rhel8.json
    - packer validate vcenter-debian10.json

build_centos7:
  image:
    name: hashicorp/packer:light
    entrypoint: [""]
  stage: build
  script: packer build -force vcenter-centos7.json

build_centos8:
  image:
    name: hashicorp/packer:light
    entrypoint: [""]
  stage: build
  script: packer build -force vcenter-centos8.json

build_rhel8:
  image:
    name: hashicorp/packer:light
    entrypoint: [""]
  stage: build
  script: packer build -force vcenter-rhel8.json

build_debian10:
  image:
    name: hashicorp/packer:light
    entrypoint: [""]
  stage: build
  script: packer build -force vcenter-debian10.json
