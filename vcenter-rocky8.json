{
    "builders": [
        {
            "CPUs": "{{ user `cpu_cores` }}",
            "RAM": "{{ user `ram_mb` }}",
            "RAM_reserve_all": true,
            "boot_command": [
                "<up><wait>e<wait><down><wait><down><wait><end> initrd=initrd.img inst.text inst.gpt inst.ks=https://oos.eu-west-2.outscale.com/homelab/packer_ks/rhel8.cfg <leftCtrlOn>x<leftCtrlOff>"
            ],
            "boot_order": "disk,cdrom",
            "cluster": "{{ user `cluster` }}",
            "convert_to_template": true,
            "datacenter": "{{ user `dc` }}",
            "datastore": "{{ user `storage` }}",
            "disk_controller_type": "pvscsi",
            "firmware": "efi",
            "folder": "{{ user `template_dir` }}",
            "guest_os_type": "centos8_64Guest",
            "insecure_connection": "true",
            "iso_checksum": "file:https://download.rockylinux.org/pub/rocky/8.3/isos/x86_64/CHECKSUM",
            "iso_urls": [
                "https://download.rockylinux.org/pub/rocky/8.3/isos/x86_64/Rocky-8.3-x86_64-dvd1.iso"
            ],
            "network_adapters": [
                {
                    "network": "{{ user `network` }}",
                    "network_card": "vmxnet3"
                }
            ],
            "password": "{{ user `vcenter_password` }}",
            "ssh_password": "{{ user `ssh_password` }}",
            "ssh_username": "{{ user `ssh_user` }}",
            "storage": [
                {
                    "disk_size": "10000",
                    "disk_thin_provisioned": true
                }
            ],
            "type": "vsphere-iso",
            "username": "{{ user `vcenter_user` }}",
            "vcenter_server": "{{ user `vcenter_host` }}",
            "vm_name": "RockyLinux-8-{{isotime \"2006-01-02\"}}",
            "vm_version": "15"
        }
    ],
    "provisioners": [
        {
            "execute_command": "echo 'root' | {{.Vars}} sudo -S -E bash '{{.Path}}'",
            "script": "scripts/prep_centos8.sh",
            "type": "shell"
        }
    ],
    "variables": {
        "cluster": "Main",
        "cpu_cores": "1",
        "dc": "Home",
        "network": "SEC-PROVI",
        "ram_mb": "2048",
        "ssh_password": "root",
        "ssh_user": "root",
        "storage": "SAN",
        "template_dir": "templates",
        "vcenter_host": "{{ env `VCENTER_HOST` }}",
        "vcenter_password": "{{ env `VCENTER_PASSWORD` }}",
        "vcenter_user": "{{ env `VCENTER_USER` }}"
    }
}
