{
  "variables": {
    "vcenter_host": "{{ env `VCENTER_HOST` }}",
    "vcenter_user": "{{ env `VCENTER_USER` }}",
    "vcenter_password": "{{ env `VCENTER_PASSWORD` }}",
    "ssh_user": "root",
    "ssh_password": "root",
    "dc": "Home",
    "cluster": "Main",
    "network": "SEC-PROVI",
    "storage": "san",
    "template_dir": "templates",
    "cpu_cores": "1",
    "ram_mb": "2048"
  },

  "builders": [
    {
      "type": "vsphere-iso",

      "vcenter_server": "{{ user `vcenter_host` }}",
      "username": "{{ user `vcenter_user` }}",
      "password": "{{ user `vcenter_password` }}",
      "insecure_connection": "true",
      "ssh_username": "{{ user `ssh_user` }}",
      "ssh_password": "{{ user `ssh_password` }}",

      "vm_version": "13",

      "datacenter": "{{ user `dc` }}",
      "cluster": "{{ user `cluster` }}",
      "network": "{{ user `network` }}",
      "network_card": "vmxnet3",
      "datastore": "{{ user `storage` }}",
      "vm_name": "CentOS-8-{{isotime \"2006-01-02\"}}",
      "guest_os_type": "centos7_64Guest",

      "CPUs": "{{ user `cpu_cores` }}",
      "RAM": "{{ user `ram_mb` }}",
      "RAM_reserve_all": true,

      "disk_controller_type": "pvscsi",
      "disk_size": "10000",
      "disk_thin_provisioned": true,
      "folder": "{{ user `template_dir` }}",

      "http_directory": "kickstart",
      "boot_command": [
        "<tab> text inst.ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks8.cfg<enter><wait>"
      ],

      "iso_urls": [
        "https://mirrors.ircam.fr/pub/CentOS/8/isos/x86_64/CentOS-8.1.1911-x86_64-boot.iso"
      ],
      "iso_checksum_url": "https://mirrors.ircam.fr/pub/CentOS/8/isos/x86_64/CHECKSUM",
      "iso_checksum_type": "sha256",
      "http_port_min": 8080,
      "http_port_max": 8080,
      "boot_order": "disk,cdrom",
      "convert_to_template": true
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "execute_command": "echo 'root' | {{.Vars}} sudo -S -E bash '{{.Path}}'",
      "script": "scripts/prep_centos8.sh"
    }
  ]
}
