{
    "builders": [
        {
            "type": "vsphere-iso",
            "CPUs": "{{ user `cpu_cores` }}",
            "RAM": "{{ user `ram_mb` }}",
            "RAM_reserve_all": true,
            "boot_wait": "5s",
            "boot_command": [
                "<esc><esc><esc>",
                "<enter><wait>",
                "/casper/vmlinuz ",
                "root=/dev/sr0 ",
                "initrd=/casper/initrd ",
                "autoinstall ",
                "ds=nocloud-net;s=https://oos.eu-west-2.outscale.com/homelab/packer_ks/ubuntu2004/",
                "<enter>"
            ],
            "boot_order": "disk,cdrom",
            "cluster": "{{ user `cluster` }}",
            "convert_to_template": true,
            "datacenter": "{{ user `dc` }}",
            "datastore": "{{ user `storage` }}",
            "disk_controller_type": "pvscsi",
            "folder": "{{ user `template_dir` }}",
            "guest_os_type": "ubuntu64Guest",
            "insecure_connection": "true",
            "iso_checksum": "file:https://releases.ubuntu.com/focal/SHA256SUMS",
            "iso_urls": [
                "https://releases.ubuntu.com/focal/ubuntu-20.04.1-live-server-amd64.iso"
            ],
            "network_adapters": [
                {
                    "network": "{{ user `network` }}",
                    "network_card": "vmxnet3"
                }
            ],
            "password": "{{ user `vcenter_password` }}",
            "ssh_password": "{{ user `ssh_password` }}",
            "ssh_username": "{{ user `ssh_user` }}",
            "ssh_timeout": "25m",
            "ssh_handshake_attempts": "150",
            "storage": [
                {
                    "disk_size": "10000",
                    "disk_thin_provisioned": true
                }
            ],
            "username": "{{ user `vcenter_user` }}",
            "vcenter_server": "{{ user `vcenter_host` }}",
            "vm_name": "Ubuntu-20.04-{{isotime \"2006-01-02\"}}",
            "vm_version": "13"
        }
    ],
    "provisioners": [
        {
            "execute_command": "echo 'root' | {{.Vars}} sudo -S -E bash '{{.Path}}'",
            "script": "scripts/prep_debian10.sh",
            "type": "shell"
        }
    ],
    "variables": {
        "cluster": "Main",
        "cpu_cores": "2",
        "dc": "Home",
        "network": "SEC-PROVI",
        "ram_mb": "2048",
        "ssh_password": "root",
        "ssh_user": "root",
        "storage": "SAN",
        "template_dir": "templates",
        "vcenter_host": "{{ env `VCENTER_HOST` }}",
        "vcenter_password": "{{ env `VCENTER_PASSWORD` }}",
        "vcenter_user": "{{ env `VCENTER_USER` }}"
    }
}
